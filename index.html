<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Школьное расписание | Telegram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        telegram: {
                            light: '#f4f4f5',
                            DEFAULT: '#0088cc',
                            dark: '#17212b',
                            darker: '#0e1621',
                            text: '#e1e3e6',
                            secondary: '#6b7c85',
                            blue: '#2b5278',
                            lightblue: '#3a6d99',
                            bg: 'var(--tg-theme-bg-color, #17212b)',
                            text: 'var(--tg-theme-text-color, #e1e3e6)',
                            hint: 'var(--tg-theme-hint-color, #6b7c85)',
                            link: 'var(--tg-theme-link-color, #0088cc)',
                            button: 'var(--tg-theme-button-color, #0088cc)',
                            buttonText: 'var(--tg-theme-button-text-color, #ffffff)',
                            secondaryBg: 'var(--tg-theme-secondary-bg-color, #1f2c36)',
                            math: '#FF6B6B',
                            physics: '#4ECDC4',
                            chemistry: '#45B7D1',
                            biology: '#A5D8A7',
                            literature: '#FFD166',
                            language: '#FF9F1C',
                            history: '#A37AFC',
                            geography: '#7FDBFF',
                            informatics: '#7DEDFF',
                            pe: '#2ECC71',
                            art: '#F368E0',
                            music: '#FF9FF3',
                            other: '#C5E3F6'
                        }
                    },
                    fontFamily: {
                        'telegram': ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--tg-theme-bg-color, #17212b);
            color: var(--tg-theme-text-color, #e1e3e6);
        }
        
        .telegram-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        .telegram-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .telegram-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
        
        .day-tab.active {
            background-color: rgba(0, 136, 204, 0.2);
            color: var(--tg-theme-link-color, #0088cc);
        }
        
        .current-day-tab {
            background-color: rgba(0, 136, 204, 0.3);
            color: var(--tg-theme-link-color, #0088cc);
            font-weight: 500;
        }
        
        .lesson-card {
            transition: all 0.2s ease;
            border-left: 4px solid;
            background-color: var(--tg-theme-secondary-bg-color, rgba(255,255,255,0.03));
            position: relative;
            overflow: hidden;
        }
        
        .current-lesson {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 136, 204, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 136, 204, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 136, 204, 0); }
        }
        
        .progress-bar {
            height: 3px;
            background: linear-gradient(90deg, var(--tg-theme-link-color, #0088cc), #00a2ff);
        }
        
        .class-selector {
            background-color: var(--tg-theme-secondary-bg-color, rgba(255,255,255,0.05));
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 12px;
        }
        
        .class-option {
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            flex: 1;
        }
        
        .class-option.active {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            font-weight: 500;
        }
        
        .floating-button {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }
        
        .floating-button:hover {
            transform: translateY(-2px);
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: var(--tg-theme-bg-color, #17212b);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 16px;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #1f2c36);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 16px;
        }
        
        .modal-footer {
            padding: 16px;
            border-top: 1px solid var(--tg-theme-secondary-bg-color, #1f2c36);
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        
        .input-field {
            margin-bottom: 16px;
        }
        
        .input-field label {
            display: block;
            margin-bottom: 6px;
            color: var(--tg-theme-hint-color, #6b7c85);
            font-size: 14px;
        }
        
        .input-field input, .input-field select {
            width: 100%;
            padding: 10px 12px;
            background-color: var(--tg-theme-secondary-bg-color, #1f2c36);
            border: 1px solid var(--tg-theme-secondary-bg-color, #1f2c36);
            border-radius: 8px;
            color: var(--tg-theme-text-color, #e1e3e6);
            transition: border-color 0.2s ease;
        }
        
        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: var(--tg-theme-link-color, #0088cc);
        }
        
        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        .btn-primary {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        
        .btn-primary:hover {
            background-color: var(--tg-theme-link-color, #0077b3);
        }
        
        .btn-secondary {
            background-color: var(--tg-theme-secondary-bg-color, #1f2c36);
            color: var(--tg-theme-text-color, #e1e3e6);
        }
        
        .btn-secondary:hover {
            background-color: var(--tg-theme-secondary-bg-color, #2a3a48);
        }
        
        .btn-danger {
            background-color: '#e53935';
            color: 'white';
        }
        
        .btn-danger:hover {
            background-color: '#c62828';
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 280px;
            background-color: var(--tg-theme-bg-color, #17212b);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 100;
            border-right: 1px solid var(--tg-theme-secondary-bg-color, #1f2c36);
        }
        
        .sidebar.active {
            transform: translateX(0);
        }
        
        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #1f2c36);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sidebar-menu {
            padding: 8px 0;
            overflow-y: auto;
            height: calc(100% - 60px);
        }
        
        .sidebar-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-left: 4px solid transparent;
        }
        
        .sidebar-item:hover {
            background-color: var(--tg-theme-secondary-bg-color, #1f2c36);
            border-left-color: var(--tg-theme-link-color, #0088cc);
        }
        
        .sidebar-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            color: var(--tg-theme-hint-color, #6b7c85);
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .edit-lesson-btn {
            position: absolute;
            right: 10px;
            bottom: 10px;
            background-color: var(--tg-theme-secondary-bg-color, #1f2c36);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
        }
        
        .lesson-card:hover .edit-lesson-btn {
            opacity: 1;
        }
        
        .add-lesson-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 8px;
            background-color: var(--tg-theme-secondary-bg-color, #1f2c36);
            color: var(--tg-theme-link-color, #0088cc);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }
        
        .add-lesson-btn:hover {
            background-color: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        
        .subject-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .autocomplete-items {
            position: absolute;
            border: 1px solid var(--tg-theme-secondary-bg-color, #1f2c36);
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: var(--tg-theme-bg-color, #17212b);
            border-bottom: 1px solid var(--tg-theme-secondary-bg-color, #1f2c36);
        }
        
        .autocomplete-items div:hover {
            background-color: var(--tg-theme-secondary-bg-color, #1f2c36);
        }
        
        .autocomplete-active {
            background-color: var(--tg-theme-link-color, #0088cc) !important;
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        
        @media (max-width: 400px) {
            .day-tab {
                padding: 8px 6px;
                font-size: 12px;
                min-width: 40px;
            }
            
            .class-option {
                padding: 6px 4px;
                font-size: 12px;
            }
            
            .lesson-card {
                padding: 12px;
            }
            
            .subject-icon {
                width: 32px;
                height: 32px;
                margin-right: 8px;
            }
            
            .sidebar {
                width: 240px;
            }
            
            .modal-content {
                width: 95%;
            }
        }
        
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top: 3px solid var(--tg-theme-link-color, #0088cc);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Оптимизация для маленьких экранов */
        @media (max-width: 375px) {
            /* iPhone SE и маленькие устройства */
            .day-tab {
                padding: 6px 4px;
                font-size: 11px;
                min-width: 30px;
            }
            
            .class-option {
                padding: 4px 2px;
                font-size: 11px;
            }
            
            .lesson-card {
                padding: 10px 8px;
            }
            
            .subject-icon {
                width: 30px;
                height: 30px;
                margin-right: 6px;
            }
            
            .sidebar {
                width: 230px;
            }
            
            .modal-content {
                width: 98%;
                max-width: 350px;
            }
            
            .modal-body {
                padding: 12px;
            }
            
            .modal-header, .modal-footer {
                padding: 12px;
            }
            
            h3.text-lg {
                font-size: 16px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            #calendarDays .calendar-day {
                font-size: 11px;
                height: 32px;
            }
            
            /* Дополнительные стили для iPhone SE */
            .teacher-card .teacher-image img {
                width: 36px;
                height: 36px;
            }
            
            #teacherDetailsContent img {
                width: 64px;
                height: 64px;
            }
            
            #calendarEvents .w-8 {
                width: 24px;
                height: 24px;
            }
        }
        
        @media (min-width: 376px) and (max-width: 428px) {
            /* iPhone 14 Pro Max и средние устройства */
            .day-tab {
                padding: 8px 6px;
                font-size: 12px;
                min-width: 40px;
            }
            
            .lesson-card {
                padding: 12px 10px;
            }
            
            .subject-icon {
                width: 32px;
                height: 32px;
                margin-right: 8px;
            }
        }
        
        /* Общие улучшения для мобильных устройств */
        @media (max-width: 480px) {
            .floating-button {
                width: 40px;
                height: 40px;
                bottom: 12px;
                right: 12px;
            }
            
            .notification {
                width: 85%;
                font-size: 13px;
                padding: 10px 12px;
            }
            
            .teacher-card {
                flex-direction: column;
            }
            
            .teacher-card .teacher-image {
                margin-bottom: 8px;
                margin-right: 0;
            }
            
            #homeworkList .subject-icon {
                width: 28px;
                height: 28px;
            }
            
            .sidebar-item i {
                margin-right: 8px;
            }
            
            .sidebar-header, .sidebar-item {
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body class="bg-telegram-darker text-telegram-text min-h-screen">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3 class="font-medium">Меню</h3>
            <button class="text-telegram-hint hover:text-telegram-text" onclick="toggleSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-menu">
            <div class="sidebar-item" onclick="showCurrentDay()">
                <i class="fas fa-calendar-day"></i>
                <span>Сегодня</span>
            </div>
            <div class="sidebar-item" onclick="showHomeworkModal()">
                <i class="fas fa-tasks"></i>
                <span>Домашние задания</span>
            </div>
            <div class="sidebar-item" onclick="showNotesModal()">
                <i class="fas fa-sticky-note"></i>
                <span>Заметки</span>
            </div>
            <div class="sidebar-item" onclick="showSettingsModal()">
                <i class="fas fa-cog"></i>
                <span>Настройки</span>
            </div>
            <div class="sidebar-item" id="adminMenuItem" onclick="toggleAdminMode()">
                <i class="fas fa-key"></i>
                <span id="adminMenuText">Войти как админ</span>
            </div>
            <div class="sidebar-item" onclick="showAboutModal()">
                <i class="fas fa-info-circle"></i>
                <span>О приложении</span>
            </div>
            <div class="sidebar-item" onclick="showHelpModal()">
                <i class="fas fa-question-circle"></i>
                <span>Помощь</span>
            </div>
            <div class="sidebar-item" onclick="showStatistics()">
                <i class="fas fa-chart-bar"></i>
                <span>Статистика</span>
            </div>
            <div class="sidebar-item" onclick="showCalendar()">
                <i class="fas fa-calendar-week"></i>
                <span>Календарь</span>
            </div>
            <div class="sidebar-item" onclick="showTeachers()">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>Преподаватели</span>
            </div>
        </div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Header -->
    <header class="bg-telegram-darker p-3 border-b border-telegram-blue/20 flex items-center sticky top-0 z-10">
        <div class="flex items-center">
            <button class="p-2 rounded-full hover:bg-telegram-blue/10 mr-2" onclick="toggleSidebar()">
                <i class="fas fa-bars text-telegram-hint"></i>
            </button>
            <h1 class="text-lg font-medium flex items-center">
                <i class="fas fa-calendar-alt mr-2 text-telegram-link"></i>
                Школьное расписание
            </h1>
        </div>
        <div class="flex space-x-2 ml-auto items-center">
            <button id="homeworkBtn" class="p-2 rounded-full hover:bg-telegram-blue/10" onclick="showHomeworkModal()">
                <i class="fas fa-tasks text-telegram-hint"></i>
            </button>
            <button id="settingsBtn" class="p-2 rounded-full hover:bg-telegram-blue/10" onclick="showSettingsModal()">
                <i class="fas fa-cog text-telegram-hint"></i>
            </button>
            <button id="adminBtn" class="p-2 rounded-full hover:bg-telegram-blue/10" onclick="toggleAdminMode()">
                <i class="fas fa-key text-telegram-hint"></i>
            </button>
            
            <!-- Профиль пользователя (скрыт по умолчанию) -->
            <div id="userProfile" class="hidden items-center ml-2">
                <img id="userAvatar" src="" alt="Profile" class="w-8 h-8 rounded-full cursor-pointer" onclick="showProfileModal()">
            </div>
            
            <!-- Кнопка входа через Telegram (показана по умолчанию) -->
            <div id="telegramLogin"></div>
        </div>
    </header>

    <!-- Class Selector -->
    <div class="container mx-auto px-3 pt-3">
        <div class="class-selector">
            <div class="flex">
                <div class="class-option active" onclick="selectClass('10a')">10А</div>
                <div class="class-option" onclick="selectClass('10b')">10Б</div>
                <div class="class-option" onclick="selectClass('11a')">11А</div>
                <div class="class-option" onclick="selectClass('11b')">11Б</div>
            </div>
        </div>
    </div>

    <!-- Current Info -->
    <div class="bg-telegram-blue/10 py-2 px-4 border-b border-telegram-blue/20">
        <div class="container mx-auto">
            <div class="flex justify-between items-center text-sm">
                <div class="flex-1 truncate">
                    <span class="text-telegram-hint">Сейчас:</span>
                    <span id="currentLesson" class="ml-1 font-medium">-</span>
                </div>
                <div id="currentTime" class="font-mono bg-telegram-blue/20 px-2 py-1 rounded text-xs"></div>
                <div class="flex-1 text-right truncate">
                    <span class="text-telegram-hint">Далее:</span>
                    <span id="nextLesson" class="ml-1">-</span>
                </div>
            </div>
            <div class="progress-bar mt-2 rounded-full" id="lessonProgress" style="width: 0%"></div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="container mx-auto p-3 overflow-x-auto">
        <div class="flex space-x-1 min-w-max">
            <button onclick="showDay('monday')" class="day-tab px-4 py-2 rounded-lg text-sm bg-telegram-blue/5 hover:bg-telegram-blue/10 transition flex-1 text-center min-w-[60px]">Пн</button>
            <button onclick="showDay('tuesday')" class="day-tab px-4 py-2 rounded-lg text-sm bg-telegram-blue/5 hover:bg-telegram-blue/10 transition flex-1 text-center min-w-[60px]">Вт</button>
            <button onclick="showDay('wednesday')" class="day-tab px-4 py-2 rounded-lg text-sm bg-telegram-blue/5 hover:bg-telegram-blue/10 transition flex-1 text-center min-w-[60px]">Ср</button>
            <button onclick="showDay('thursday')" class="day-tab px-4 py-2 rounded-lg text-sm bg-telegram-blue/5 hover:bg-telegram-blue/10 transition flex-1 text-center min-w-[60px]">Чт</button>
            <button onclick="showDay('friday')" class="day-tab px-4 py-2 rounded-lg text-sm bg-telegram-blue/5 hover:bg-telegram-blue/10 transition flex-1 text-center min-w-[60px]">Пт</button>
        </div>
    </div>

    <!-- Schedule Content -->
    <main class="container mx-auto p-3 pb-20 telegram-scrollbar" id="scheduleContent">
        <!-- Расписание будет загружено здесь -->
    </main>

    <!-- Floating Button -->
    <button id="nowButton" class="floating-button fixed bottom-4 right-4 bg-telegram-button text-telegram-button-text w-12 h-12 rounded-full flex items-center justify-center" onclick="showCurrentDay()">
        <i class="fas fa-bell"></i>
    </button>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-cog mr-2 text-telegram-link"></i> Настройки
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('settingsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="settingsAdminMessage" class="bg-telegram-blue/10 p-3 rounded-lg mb-4 text-sm text-telegram-hint hidden">
                    <i class="fas fa-lock mr-2"></i> Для изменения длительности уроков и перемен необходимы права администратора
                </div>
                
                <div class="input-field">
                    <label>Показывать перемены</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="showBreaks" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-telegram-blue/20 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-telegram-button"></div>
                    </label>
                </div>
                
                <div class="input-field">
                    <label for="lessonDuration">Длительность урока (мин):</label>
                    <input type="number" id="lessonDuration" value="40" min="20" max="60" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                </div>
                
                <div class="input-field">
                    <label for="shortBreak">Короткая перемена (мин):</label>
                    <input type="number" id="shortBreak" value="10" min="5" max="20" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                </div>
                
                <div class="input-field">
                    <label for="longBreak">Длинная перемена (мин):</label>
                    <input type="number" id="longBreak" value="15" min="10" max="30" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('settingsModal')">Отмена</button>
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save mr-2"></i> Сохранить
                </button>
            </div>
        </div>
    </div>

    <!-- Homework Modal -->
    <div class="modal-overlay" id="homeworkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-tasks mr-2 text-telegram-link"></i> Домашние задания
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('homeworkModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="homeworkList">
                    <!-- Список домашних заданий будет здесь -->
                </div>
                
                <div class="mt-4">
                    <h4 class="font-medium mb-2">Добавить задание</h4>
                    <div class="input-field">
                        <label for="hwSubject">Предмет:</label>
                        <input type="text" id="hwSubject" class="w-full p-2 bg-telegram-blue/10 rounded-lg" placeholder="Название предмета">
                    </div>
                    
                    <div class="input-field">
                        <label for="hwTask">Задание:</label>
                        <textarea id="hwTask" class="w-full p-2 bg-telegram-blue/10 rounded-lg" rows="3" placeholder="Описание задания"></textarea>
                    </div>
                    
                    <div class="input-field">
                        <label for="hwDueDate">Срок сдачи:</label>
                        <input type="date" id="hwDueDate" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('homeworkModal')">Отмена</button>
                <button class="btn btn-primary" onclick="addHomework()">
                    <i class="fas fa-plus mr-2"></i> Добавить
                </button>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div class="modal-overlay" id="notesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-sticky-note mr-2 text-telegram-link"></i> Заметки
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('notesModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="notesList">
                    <!-- Список заметок будет здесь -->
                </div>
                
                <div class="mt-4">
                    <h4 class="font-medium mb-2">Добавить заметка</h4>
                    <div class="input-field">
                        <label for="noteTitle">Заголовок:</label>
                        <input type="text" id="noteTitle" class="w-full p-2 bg-telegram-blue/10 rounded-lg" placeholder="Название заметки">
                    </div>
                    
                    <div class="input-field">
                        <label for="noteContent">Содержание:</label>
                        <textarea id="noteContent" class="w-full p-2 bg-telegram-blue/10 rounded-lg" rows="3" placeholder="Текст заметки"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('notesModal')">Отмена</button>
                <button class="btn btn-primary" onclick="addNote()">
                    <i class="fas fa-plus mr-2"></i> Добавить
                </button>
            </div>
        </div>
    </div>

    <!-- Add Lesson Modal -->
    <div class="modal-overlay" id="addLessonModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-plus mr-2 text-telegram-link"></i> Добавить урок
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('addLessonModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="input-field">
                    <label for="addSubject">Предмет:</label>
                    <input type="text" id="addSubject" class="w-full p-2 bg-telegram-blue/10 rounded-lg" placeholder="Название предмета" onkeyup="autocompleteSubject(this)">
                    <div id="subjectAutocomplete" class="autocomplete-items"></div>
                </div>
                
                <div class="input-field">
                    <label for="addRoom">Кабинет:</label>
                    <input type="text" id="addRoom" class="w-full p-2 bg-telegram-blue/10 rounded-lg" placeholder="Номер кабинета">
                </div>
                
                <div class="input-field">
                    <label for="addTeacher">Учитель:</label>
                    <input type="text" id="addTeacher" class="w-full p-2 bg-telegram-blue/10 rounded-lg" placeholder="ФИО учителя">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('addLessonModal')">Отмена</button>
                <button class="btn btn-primary" onclick="addLesson()">
                    <i class="fas fa-plus mr-2"></i> Добавить
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Lesson Modal -->
    <div class="modal-overlay" id="editLessonModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-edit mr-2 text-telegram-link"></i> Редактировать урок
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('editLessonModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <input type="hidden" id="editLessonDay">
                <input type="hidden" id="editLessonIndex">
                
                <div class="input-field">
                    <label for="editSubject">Предмет:</label>
                    <input type="text" id="editSubject" class="w-full p-2 bg-telegram-blue/10 rounded-lg" onkeyup="autocompleteSubject(this)">
                    <div id="editSubjectAutocomplete" class="autocomplete-items"></div>
                </div>
                
                <div class="input-field">
                    <label for="editRoom">Кабинет:</label>
                    <input type="text" id="editRoom" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                </div>
                
                <div class="input-field">
                    <label for="editTeacher">Учитель:</label>
                    <input type="text" id="editTeacher" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="deleteLesson()">
                    <i class="fas fa-trash mr-2"></i> Удалить
                </button>
                <button class="btn btn-secondary" onclick="hideModal('editLessonModal')">Отмена</button>
                <button class="btn btn-primary" onclick="saveLesson()">
                    <i class="fas fa-save mr-2"></i> Сохранить
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="modal-overlay" id="adminLoginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-key mr-2 text-telegram-link"></i> Вход в админ-панель
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('adminLoginModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="input-field relative">
                    <label for="adminPassword">Пароль:</label>
                    <input type="password" id="adminPassword" class="w-full p-2 bg-telegram-blue/10 rounded-lg pr-10" placeholder="Введите пароль">
                    <button class="absolute right-3 top-9 text-telegram-hint hover:text-telegram-text" onclick="togglePasswordVisibility()">
                        <i id="passwordToggleIcon" class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('adminLoginModal')">Отмена</button>
                <button class="btn btn-primary" onclick="adminLogin()">
                    <i class="fas fa-sign-in-alt mr-2"></i> Войти
                </button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal-overlay" id="aboutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-info-circle mr-2 text-telegram-link"></i> О приложении
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('aboutModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="text-center mb-4">
                    <i class="fas fa-calendar-alt text-4xl text-telegram-link mb-3"></i>
                    <h2 class="text-xl font-medium">Школьное расписание</h2>
                    <p class="text-telegram-hint">Версия 1.1.0</p>
                </div>
                
                <div class="space-y-3">
                    <p>Это приложение помогает ученикам и учителям следить за расписанием занятий в школе.</p>
                    <p>Новые функции:</p>
                    <ul class="list-disc pl-5 text-telegram-hint">
                        <li>Домашние задания</li>
                        <li>Заметки</li>
                        <li>Иконки для каждого предмета</li>
                        <li>Цветовая дифференциация уроков</li>
                        <li>Автодополнение названий предметов</li>
                        <li>Оптимизация для мобильных устройств</li>
                    </ul>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideModal('aboutModal')">Закрыть</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-question-circle mr-2 text-telegram-link"></i> Помощь
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('helpModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium mb-2">Как добавить урок?</h4>
                        <p class="text-telegram-hint">1. Войдите в режим администратора (иконка ключа)</p>
                        <p class="text-telegram-hint">2. Нажмите на кнопку "+" внизу экрана</p>
                        <p class="text-telegram-hint">3. Заполните данные о предмете, кабинете и преподавателе</p>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-2">Как добавить домашнее задание?</h4>
                        <p class="text-telegram-hint">1. Нажмите на иконку задач в правом верхнем углу</p>
                        <p class="text-telegram-hint">2. Заполните форму и нажмите "Добавить"</p>
                    </div>
                    
                    <div>
                        <h4 class="font-medium mb-2">Как изменить расписание?</h4>
                        <p class="text-telegram-hint">1. Войдите в режим администратора</p>
                        <p class="text-telegram-hint">2. Нажмите на карандаш в правом нижнем углу карточки урока</p>
                        <p class="text-telegram-hint">3. Внесите изменения и сохраните</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideModal('helpModal')">Закрыть</button>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div class="modal-overlay" id="statisticsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-chart-bar mr-2 text-telegram-link"></i> Статистика
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('statisticsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-telegram-blue/10 p-4 rounded-lg">
                        <div class="text-telegram-hint text-sm">Всего уроков</div>
                        <div class="text-2xl font-bold" id="totalLessons">0</div>
                    </div>
                    
                    <div class="bg-telegram-blue/10 p-4 rounded-lg">
                        <div class="text-telegram-hint text-sm">Домашних заданий</div>
                        <div class="text-2xl font-bold" id="totalHomework">0</div>
                    </div>
                    
                    <div class="bg-telegram-blue/10 p-4 rounded-lg">
                        <div class="text-telegram-hint text-sm">Заметок</div>
                        <div class="text-2xl font-bold" id="totalNotes">0</div>
                    </div>
                    
                    <div class="bg-telegram-blue/10 p-4 rounded-lg">
                        <div class="text-telegram-hint text-sm">Дней до каникул</div>
                        <div class="text-2xl font-bold" id="daysToHolidays">0</div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-medium mb-2">Распределение предметов</h4>
                    <div id="subjectDistribution" class="space-y-2">
                        <!-- График распределения предметов будет здесь -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideModal('statisticsModal')">Закрыть</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Teachers Modal -->
    <div class="modal-overlay" id="teachersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-chalkboard-teacher mr-2 text-telegram-link"></i> Преподаватели
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('teachersModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body telegram-scrollbar" style="max-height: 70vh; overflow-y: auto;">
                <div class="flex mb-3">
                    <input type="text" id="teacherSearch" class="w-full p-2 bg-telegram-blue/10 rounded-lg" placeholder="Поиск преподавателя..." oninput="filterTeachers()">
                </div>
                
                <div id="teachersList">
                    <!-- Teachers list will be loaded here -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="hideModal('teachersModal')">Закрыть</button>
            </div>
        </div>
    </div>
    
    <!-- Teacher Details Modal -->
    <div class="modal-overlay" id="teacherDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center" id="teacherDetailsName">
                    <i class="fas fa-user mr-2 text-telegram-link"></i> Информация о преподавателе
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('teacherDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body" id="teacherDetailsContent">
                <!-- Teacher details will be loaded here -->
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('teacherDetailsModal')">Закрыть</button>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div class="modal-overlay" id="calendarModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-calendar-alt mr-2 text-telegram-link"></i> Календарь
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('calendarModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="flex justify-between items-center mb-4">
                    <button class="p-2 rounded-full hover:bg-telegram-blue/10" onclick="changeMonth(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h4 id="calendarMonth" class="text-lg font-medium">Месяц год</h4>
                    <button class="p-2 rounded-full hover:bg-telegram-blue/10" onclick="changeMonth(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-7 gap-1 text-center mb-2">
                    <div class="text-telegram-hint text-sm">Пн</div>
                    <div class="text-telegram-hint text-sm">Вт</div>
                    <div class="text-telegram-hint text-sm">Ср</div>
                    <div class="text-telegram-hint text-sm">Чт</div>
                    <div class="text-telegram-hint text-sm">Пт</div>
                    <div class="text-telegram-hint text-sm">Сб</div>
                    <div class="text-telegram-hint text-sm">Вс</div>
                </div>
                
                <div id="calendarDays" class="grid grid-cols-7 gap-1">
                    <!-- Calendar days will be generated here -->
                </div>
                
                <div class="mt-4 pt-3 border-t border-telegram-blue/20">
                    <h4 class="font-medium mb-2">События на выбранный день</h4>
                    <div id="calendarEvents" class="space-y-2">
                        <!-- Events will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('calendarModal')">Закрыть</button>
                <button class="btn btn-primary" onclick="showAddEventModal()">
                    <i class="fas fa-plus mr-2"></i> Добавить событие
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add Event Modal -->
    <div class="modal-overlay" id="addEventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-calendar-plus mr-2 text-telegram-link"></i> Добавить событие
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('addEventModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="input-field">
                    <label for="eventTitle">Название:</label>
                    <input type="text" id="eventTitle" class="w-full p-2 bg-telegram-blue/10 rounded-lg" placeholder="Название события">
                </div>
                
                <div class="input-field">
                    <label for="eventDate">Дата:</label>
                    <input type="date" id="eventDate" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                </div>
                
                <div class="input-field">
                    <label for="eventType">Тип события:</label>
                    <select id="eventType" class="w-full p-2 bg-telegram-blue/10 rounded-lg">
                        <option value="lesson">Урок</option>
                        <option value="exam">Контрольная работа</option>
                        <option value="holiday">Праздник</option>
                        <option value="activity">Мероприятие</option>
                    </select>
                </div>
                
                <div class="input-field">
                    <label for="eventDescription">Описание:</label>
                    <textarea id="eventDescription" class="w-full p-2 bg-telegram-blue/10 rounded-lg" rows="3" placeholder="Описание события"></textarea>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('addEventModal')">Отмена</button>
                <button class="btn btn-primary" onclick="addCalendarEvent()">
                    <i class="fas fa-plus mr-2"></i> Добавить
                </button>
            </div>
        </div>
    </div>

    <!-- Добавим модальное окно профиля -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-medium flex items-center">
                    <i class="fas fa-user mr-2 text-telegram-link"></i> Профиль
                </h3>
                <button class="text-telegram-hint hover:text-telegram-text" onclick="hideModal('profileModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="flex items-center mb-4">
                    <img id="profileAvatar" src="" alt="Profile" class="w-16 h-16 rounded-full mr-4">
                    <div>
                        <h4 id="profileName" class="font-medium text-lg"></h4>
                        <p id="profileUsername" class="text-telegram-hint"></p>
                    </div>
                </div>
                
                <div class="bg-telegram-blue/5 p-3 rounded-lg mb-3">
                    <h5 class="font-medium mb-2">Статистика</h5>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <div class="text-telegram-hint text-sm">Домашних заданий</div>
                            <div id="profileHomeworkCount" class="text-lg font-medium">0</div>
                        </div>
                        <div>
                            <div class="text-telegram-hint text-sm">Заметок</div>
                            <div id="profileNotesCount" class="text-lg font-medium">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-telegram-blue/5 p-3 rounded-lg">
                    <h5 class="font-medium mb-2">Настройки профиля</h5>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-telegram-hint">Уведомления</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="profileNotifications" class="sr-only peer">
                                <div class="w-11 h-6 bg-telegram-blue/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-telegram-button"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="logoutTelegram()">
                    <i class="fas fa-sign-out-alt mr-2"></i> Выйти
                </button>
                <button class="btn btn-primary" onclick="hideModal('profileModal')">Закрыть</button>
            </div>
        </div>
    </div>

    <script>
        // Конфигурация
        const DEFAULT_LESSON_DURATION = 40;
        const DEFAULT_SHORT_BREAK = 10;
        const DEFAULT_LONG_BREAK = 15;
        const ADMIN_PASSWORD = "admin123"; // Простой пароль для демонстрации
        
        // Список предметов для автодополнения
        const SUBJECTS = [
            "Математика", "Алгебра", "Геометрия", "Физика", "Химия", 
            "Биология", "Русский язык", "Литература", "Английский язык", 
            "История", "Обществознание", "География", "Информатика", 
            "Физкультура", "ИЗО", "Музыка", "Технология", "ОБЖ"
        ];
        
        // Иконки для предметов
        const SUBJECT_ICONS = {
            "Математика": "fa-square-root-alt",
            "Алгебра": "fa-square-root-alt",
            "Геометрия": "fa-shapes",
            "Физика": "fa-atom",
            "Химия": "fa-flask",
            "Биология": "fa-dna",
            "Русский язык": "fa-language",
            "Литература": "fa-book-open",
            "Английский язык": "fa-globe-europe",
            "История": "fa-landmark",
            "Обществознание": "fa-users",
            "География": "fa-globe-americas",
            "Информатика": "fa-laptop-code",
            "Физкультура": "fa-running",
            "ИЗО": "fa-palette",
            "Музыка": "fa-music",
            "Технология": "fa-tools",
            "ОБЖ": "fa-shield-alt",
            "Другой": "fa-book"
        };
        
        // Цвета для предметов
        const SUBJECT_COLORS = {
            "Математика": "telegram-math",
            "Алгебра": "telegram-math",
            "Геометрия": "telegram-math",
            "Физика": "telegram-physics",
            "Химия": "telegram-chemistry",
            "Биология": "telegram-biology",
            "Русский язык": "telegram-language",
            "Литература": "telegram-literature",
            "Английский язык": "telegram-language",
            "История": "telegram-history",
            "Обществознание": "telegram-history",
            "География": "telegram-geography",
            "Информатика": "telegram-informatics",
            "Физкультура": "telegram-pe",
            "ИЗО": "telegram-art",
            "Музыка": "telegram-music",
            "Технология": "telegram-other",
            "ОБЖ": "telegram-other",
            "Другой": "telegram-other"
        };
        
        // Данные расписания для разных классов
        const CLASS_SCHEDULES = {
            '10a': {
        'monday': [
            { 'subject': "Проект", 'room': "14", 'teacher': "" },
            { 'subject': "История", 'room': "13", 'teacher': "" },
            { 'subject': "Разг. о важном", 'room': "15", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
        ],
        'tuesday': [
            { 'subject': "Физика", 'room': "50", 'teacher': "" },
            { 'subject': "Физика", 'room': "50", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Россия", 'room': "16", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "28, 47", 'teacher': "" },
        ],
        'wednesday': [
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Химия", 'room': "51", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "Физика", 'room': "50", 'teacher': "" },
            { 'subject': "Биология", 'room': "15", 'teacher': "" },
        ],
        'thursday': [
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "География", 'room': "33", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "47, 28", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "История", 'room': "13", 'teacher': "" },
        ],
        'friday': [
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "28/инф.", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "47/инф.", 'teacher': "" },
            { 'subject': "Химия", 'room': "51", 'teacher': "" },
            { 'subject': "ОБЖ", 'room': "45", 'teacher': "" },
        ],
    },
    '10b': {
        'monday': [
            { 'subject': "Разг. о важном", 'room': "45", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "История", 'room': "13", 'teacher': "" },
            { 'subject': "Разг. о важном", 'room': "45", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "29/инф.", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
        ],
        'tuesday': [
            { 'subject': "Биология", 'room': "15", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Физика", 'room': "50", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "Биология", 'room': "15", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "24, 29", 'teacher': "" },
        ],
        'wednesday': [
            { 'subject': "История", 'room': "13", 'teacher': "" },
            { 'subject': "Функц. грамот.", 'room': "45", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Химия", 'room': "51", 'teacher': "" },
            { 'subject': "Химия", 'room': "51", 'teacher': "" },
            { 'subject': "Биология", 'room': "15", 'teacher': "" },
        ],
        'thursday': [
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "Россия", 'room': "45", 'teacher': "" },
            { 'subject': "География", 'room': "33", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Инф./ин. язык", 'room': "29", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
        ],
        'friday': [
            { 'subject': "Физкультура (д)", 'room': "", 'teacher': "" },
            { 'subject': "Химия", 'room': "51", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "ОБЖ", 'room': "45", 'teacher': "" },
            { 'subject': "Проект", 'room': "14", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "47, 36", 'teacher': "" },
        ],
    },
    '11a': {
        'monday': [
            { 'subject': "Разг. о важном", 'room': "47", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "47/инф.", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "34", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "47", 'teacher': "" },
        ],
        'tuesday': [
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "34", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "История", 'room': "13", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
        ],
        'wednesday': [
            { 'subject': "Ин. язык", 'room': "47", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "34", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "ОБЖ", 'room': "45", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
        ],
        'thursday': [
            { 'subject': "Химия", 'room': "51", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "34", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "47", 'teacher': "" },
        ],
        'friday': [
            { 'subject': "История", 'room': "13", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Математика", 'room': "53", 'teacher': "" },
            { 'subject': "Биология", 'room': "15", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "34", 'teacher': "" },
            { 'subject': "Ин. язык", 'room': "47", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "(м)", 'teacher': "" },
        ],
    },
    '11b': {
        'monday': [
            { 'subject': "Разг. о важном", 'room': "25", 'teacher': "" },
            { 'subject': "Математика", 'room': "25", 'teacher': "" },
            { 'subject': "Ин. язык 28/инф.", 'room': "", 'teacher': "" },
            { 'subject': "Инф./ин. язык", 'room': "47", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
        ],
        'tuesday': [
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Математика", 'room': "25", 'teacher': "" },
            { 'subject': "Математика", 'room': "25", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
        ],
        'wednesday': [
            { 'subject': "ОБЖ", 'room': "45", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Математика", 'room': "25", 'teacher': "" },
            { 'subject': "История", 'room': "13", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Физкультура", 'room': "", 'teacher': "" },
        ],
        'thursday': [
            { 'subject': "География", 'room': "33", 'teacher': "" },
            { 'subject': "Математика", 'room': "25", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Физика", 'room': "49", 'teacher': "" },
            { 'subject': "Математика", 'room': "25", 'teacher': "" },
        ],
        'friday': [
            { 'subject': "Ин. язык", 'room': "47, 28", 'teacher': "" },
            { 'subject': "История", 'room': "13", 'teacher': "" },
            { 'subject': "Обществознание", 'room': "13", 'teacher': "" },
            { 'subject': "Биология", 'room': "15", 'teacher': "" },
            { 'subject': "География", 'room': "33", 'teacher': "" },
            { 'subject': "Русский язык", 'room': "35", 'teacher': "" },
        ],
    }


        };
        
        // Глобальные переменные
        let currentDay = 'monday';
        let currentClass = '10a';
        let scheduleData = {};
        let scheduleTimes = [];
        let isAdmin = false;
        let shortBreakDuration = DEFAULT_SHORT_BREAK;
        let longBreakDuration = DEFAULT_LONG_BREAK;
        let homeworkData = {};
        let notesData = {};
        
        // События календаря
        let calendarEvents = [];
        const HOLIDAYS = [
            { date: '2023-09-01', title: 'День знаний', type: 'holiday', description: 'Начало учебного года' },
            { date: '2023-11-04', title: 'День народного единства', type: 'holiday', description: 'Государственный праздник' },
            { date: '2023-12-31', title: 'Новогодние каникулы', type: 'holiday', description: 'Зимние каникулы' },
            { date: '2024-01-07', title: 'Рождество', type: 'holiday', description: 'Православный праздник' },
            { date: '2024-02-23', title: 'День защитника Отечества', type: 'holiday', description: 'Государственный праздник' },
            { date: '2024-03-08', title: 'Международный женский день', type: 'holiday', description: 'Государственный праздник' },
            { date: '2024-05-01', title: 'Праздник Весны и Труда', type: 'holiday', description: 'Государственный праздник' },
            { date: '2024-05-09', title: 'День Победы', type: 'holiday', description: 'День воинской славы России' }
        ];
        
        // Текущий месяц и выбранный день в календаре
        let currentCalendarMonth = new Date();
        let selectedCalendarDay = new Date();
        
        // Добавим эти функции для сохранения и загрузки состояния
        function saveCurrentState() {
            localStorage.setItem('currentClass', currentClass);
            localStorage.setItem('currentDay', currentDay);
        }

        function loadSavedState() {
            // Загружаем сохраненный класс
            const savedClass = localStorage.getItem('currentClass');
            if (savedClass) {
                currentClass = savedClass;
                // Обновляем визуальное выделение класса
                document.querySelectorAll('.class-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.textContent.toLowerCase().replace('а', 'a').replace('б', 'b') === savedClass) {
                        option.classList.add('active');
                    }
                });
            }

            // Загружаем сохраненный день
            const savedDay = localStorage.getItem('currentDay');
            if (savedDay) {
                currentDay = savedDay;
            }
        }
        
        // Модифицируем обработчик DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            // Загружаем сохраненное состояние
            loadSavedState();
            
            // Остальная инициализация
            loadSettings();
            generateScheduleTimes();
            selectClass(currentClass);
            updateClock();
            updateCurrentLesson();
            
            // Обновление времени каждую минуту
            setInterval(updateClock, 60000);
            setInterval(updateCurrentLesson, 30000);
            
            // Добавляем обработчики закрытия для всех модальных окон
            const modalIds = ['homeworkModal', 'notesModal', 'settingsModal', 'addLessonModal', 
                             'editLessonModal', 'adminLoginModal', 'aboutModal', 'helpModal', 
                             'statisticsModal', 'teachersModal', 'calendarModal'];
            
            modalIds.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (!modal) return;
                
                const closeBtns = modal.querySelectorAll('.modal-footer .btn-secondary, .modal-header button');
                closeBtns.forEach(btn => {
                    btn.onclick = function() {
                        hideModal(modalId);
                    };
                });
            });
        });
        
        // Модифицируем функцию selectClass
        function selectClass(className) {
            currentClass = className;
            scheduleData = JSON.parse(JSON.stringify(CLASS_SCHEDULES[className]));
            
            // Обновляем активную кнопку класса
            document.querySelectorAll('.class-option').forEach(option => {
                option.classList.remove('active');
                if (option.textContent.toLowerCase().replace('а', 'a').replace('б', 'b') === className) {
                    option.classList.add('active');
                }
            });
            
            // Загружаем данные из localStorage
            const savedData = localStorage.getItem(`scheduleData_${className}`);
            if (savedData) {
                scheduleData = JSON.parse(savedData);
            }
            
            // Загружаем домашние задания
            const savedHomework = localStorage.getItem(`homeworkData_${className}`);
            homeworkData = savedHomework ? JSON.parse(savedHomework) : {};
            
            // Загружаем заметки
            const savedNotes = localStorage.getItem(`notesData_${className}`);
            notesData = savedNotes ? JSON.parse(savedNotes) : {};
            
            showDay(currentDay);
            updateCurrentLesson();
            
            // Сохраняем текущее состояние
            saveCurrentState();
        }
        
        // Генерация времени уроков и перемен
        function generateScheduleTimes() {
            const lessonDuration = parseInt(localStorage.getItem('lessonDuration')) || DEFAULT_LESSON_DURATION;
            shortBreakDuration = parseInt(localStorage.getItem('shortBreak')) || DEFAULT_SHORT_BREAK;
            longBreakDuration = parseInt(localStorage.getItem('longBreak') || DEFAULT_LONG_BREAK);
            
            scheduleTimes = [];
            let time = new Date();
            
            // Установка времени начала (8:00)
            time.setHours(8, 0, 0, 0);
            
            // Генерация 7 уроков с переменами
            for (let i = 0; i < 7; i++) {
                // Урок
                const start = formatTime(time);
                time.setMinutes(time.getMinutes() + lessonDuration);
                const end = formatTime(time);
                scheduleTimes.push({ type: 'lesson', start, end });
                
                // Перемена (кроме последней)
                if (i < 6) {
                    const breakStart = formatTime(time);
                    // Увеличиваем перемену после 3-го и 4-го урока
                    const breakDuration = (i === 2 || i === 3) ? longBreakDuration : shortBreakDuration;
                    time.setMinutes(time.getMinutes() + breakDuration);
                    const breakEnd = formatTime(time);
                    scheduleTimes.push({ type: 'break', start: breakStart, end: breakEnd });
                }
            }
        }
        
        // Модифицируем функцию showDay
        function showDay(day) {
            currentDay = day;
            
            // Обновление активной вкладки
            document.querySelectorAll('.day-tab').forEach(tab => {
                tab.classList.remove('active', 'current-day-tab');
            });
            
            const today = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'][new Date().getDay()];
            const tabIndex = ['monday','tuesday','wednesday','thursday','friday'].indexOf(day);
            
            if (day === today) {
                document.querySelector(`.day-tab:nth-child(${tabIndex+1})`).classList.add('current-day-tab');
            } else {
                document.querySelector(`.day-tab:nth-child(${tabIndex+1})`).classList.add('active');
            }
            
            // Очистка контейнера
            const container = document.getElementById('scheduleContent');
            container.innerHTML = '';
            
            // Проверка на выходной
            if (scheduleData[day]?.isHoliday) {
                container.innerHTML = `
                    <div class="bg-telegram-blue/10 p-6 rounded-xl text-center">
                        <i class="fas fa-umbrella-beach text-4xl mb-3 text-telegram-link"></i>
                        <h3 class="text-lg font-medium mb-1">Выходной!</h3>
                        <p class="text-telegram-hint">Сегодня нет уроков</p>
                    </div>
                `;
                return;
            }
            
            // Проверка на пустое расписание
            if (!scheduleData[day] || scheduleData[day].length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-telegram-hint">
                        <i class="fas fa-calendar-plus text-3xl mb-2 opacity-50"></i>
                        <p>Расписание не заполнено</p>
                    </div>
                `;
                
                // Добавляем кнопку добавления урока для администратора
                if (isAdmin) {
                    container.innerHTML += `
                        <div class="add-lesson-btn" onclick="showAddLessonModal()">
                            <i class="fas fa-plus mr-2"></i> Добавить урок
                        </div>
                    `;
                }
                return;
            }
            
            // Отображение уроков и перемен
            const showBreaks = document.getElementById('showBreaks')?.checked ?? true;
            let timingIndex = 0;
            
            for (let i = 0; i < scheduleData[day].length; i++) {
                // Урок
                const lesson = scheduleData[day][i];
                const timing = scheduleTimes[timingIndex];
                
                if (!timing) break;
                
                // Определяем иконку и цвет для предмета
                const subjectKey = Object.keys(SUBJECT_ICONS).find(key => 
                    lesson.subject.toLowerCase().includes(key.toLowerCase())
                ) || "Другой";
                
                const icon = SUBJECT_ICONS[subjectKey] || "fa-book";
                const colorClass = SUBJECT_COLORS[subjectKey] || "telegram-other";
                
                const lessonHTML = `
                    <div class="lesson-card mb-3 p-4 rounded-xl border-${colorClass} relative ${isCurrentLesson(day, i) ? 'current-lesson' : ''}">
                        <div class="absolute top-3 right-3 text-xs bg-telegram-blue/20 px-2 py-0.5 rounded">
                            ${timing?.start || '??:??'}–${timing?.end || '??:??'}
                        </div>
                        <div class="flex items-center">
                            <div class="subject-icon bg-${colorClass}/20 text-${colorClass}">
                                <i class="fas ${icon}"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-medium text-lg">${lesson.subject}</h3>
                                <div class="flex flex-wrap text-sm text-telegram-hint mt-1">
                                    <span class="mr-3"><i class="fas fa-door-open mr-1"></i> ${lesson.room}</span>
                                    <span><i class="fas fa-user mr-1"></i> ${lesson.teacher}</span>
                                </div>
                            </div>
                        </div>
                        ${isAdmin ? `<div class="edit-lesson-btn" onclick="showEditLessonModal('${day}', ${i})">
                            <i class="fas fa-pencil-alt text-xs"></i>
                        </div>` : ''}
                    </div>
                `;
                container.innerHTML += lessonHTML;
                timingIndex++;
                
                // Перемена (если включена)
                if (showBreaks && timingIndex < scheduleTimes.length && scheduleTimes[timingIndex]?.type === 'break') {
                    const breakTiming = scheduleTimes[timingIndex];
                    container.innerHTML += `
                        <div class="break-card mb-3 p-3 rounded-lg bg-telegram-blue/5 flex justify-between items-center">
                            <div class="flex items-center text-telegram-hint">
                                <i class="fas fa-coffee mr-2 text-telegram-link"></i>
                                <span class="text-sm">Перемена</span>
                            </div>
                            <span class="text-xs bg-telegram-blue/10 px-2 py-0.5 rounded">${breakTiming.start}–${breakTiming.end}</span>
                        </div>
                    `;
                    timingIndex++;
                }
            }
            
            // Добавляем кнопку добавления урока для администратора
            if (isAdmin) {
                container.innerHTML += `
                    <div class="add-lesson-btn" onclick="showAddLessonModal()">
                        <i class="fas fa-plus mr-2"></i> Добавить урок
                    </div>
                `;
            }
            
            // Добавляем домашние задания для этого дня
            if (homeworkData[day] && homeworkData[day].length > 0) {
                container.innerHTML += `
                    <div class="mt-6 pt-4 border-t border-telegram-blue/20">
                        <h3 class="font-medium text-lg mb-3 flex items-center">
                            <i class="fas fa-tasks mr-2 text-telegram-link"></i> Домашние задания
                        </h3>
                        ${homeworkData[day].map(hw => `
                            <div class="bg-telegram-blue/5 p-3 rounded-lg mb-2">
                                <div class="font-medium">${hw.subject}</div>
                                <div class="text-sm text-telegram-hint mt-1">${hw.task}</div>
                                ${hw.dueDate ? `<div class="text-xs mt-2 text-telegram-hint"><i class="far fa-calendar-alt mr-1"></i> Срок: ${formatDate(new Date(hw.dueDate))}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Добавляем заметки для этого дня
            if (notesData[day] && notesData[day].length > 0) {
                container.innerHTML += `
                    <div class="mt-6 pt-4 border-t border-telegram-blue/20">
                        <h3 class="font-medium text-lg mb-3 flex items-center">
                            <i class="fas fa-sticky-note mr-2 text-telegram-link"></i> Заметки
                        </h3>
                        ${notesData[day].map(note => `
                            <div class="bg-telegram-blue/5 p-3 rounded-lg mb-2">
                                ${note.title ? `<div class="font-medium">${note.title}</div>` : ''}
                                <div class="text-sm text-telegram-hint mt-1">${note.content}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Сохраняем текущее состояние
            saveCurrentState();
        }
        
        // Проверка, является ли урок текущим
        function isCurrentLesson(day, lessonIndex) {
            const now = new Date();
            const today = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'][now.getDay()];
            
            if (today !== day) return false;
            
            const timingIndex = lessonIndex * 2; // Каждый урок + перемена
            if (!scheduleTimes[timingIndex]) return false;
            
            const [startH, startM] = scheduleTimes[timingIndex].start.split(':').map(Number);
            const [endH, endM] = scheduleTimes[timingIndex].end.split(':').map(Number);
            
            const lessonStart = new Date();
            lessonStart.setHours(startH, startM, 0, 0);
            
            const lessonEnd = new Date();
            lessonEnd.setHours(endH, endM, 0, 0);
            
            return now >= lessonStart && now <= lessonEnd;
        }
        
        // Обновление часов
        function updateClock() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }
        
        // Обновление информации о текущем уроке
        function updateCurrentLesson() {
            const now = new Date();
            const day = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'][now.getDay()];
            
            // Выходные
            if (day === 'sunday' || day === 'saturday') {
                document.getElementById('currentLesson').textContent = "Выходной";
                document.getElementById('nextLesson').textContent = "";
                document.getElementById('lessonProgress').style.width = "0%";
                return;
            }
            
            // Проверка на праздник
            if (scheduleData[day]?.isHoliday) {
                document.getElementById('currentLesson').textContent = "Выходной";
                document.getElementById('nextLesson').textContent = "";
                document.getElementById('lessonProgress').style.width = "0%";
                return;
            }
            
            const currentHour = now.getHours();
            const currentMin = now.getMinutes();
            let currentText = "Уроки окончены";
            let nextText = "";
            let progress = 100;
            
            for (let i = 0; i < scheduleTimes.length; i++) {
                const [startH, startM] = scheduleTimes[i].start.split(':').map(Number);
                const [endH, endM] = scheduleTimes[i].end.split(':').map(Number);
                
                const startTime = startH * 60 + startM;
                const endTime = endH * 60 + endM;
                const nowTime = currentHour * 60 + currentMin;
                
                if (nowTime >= startTime && nowTime <= endTime) {
                    if (scheduleTimes[i].type === 'lesson') {
                        const lessonIndex = Math.floor(i / 2);
                        if (scheduleData[day]?.[lessonIndex]) {
                            currentText = `${lessonIndex+1}. ${scheduleData[day][lessonIndex].subject}`;
                            
                            // Рассчет прогресса урока
                            const total = endTime - startTime;
                            const passed = nowTime - startTime;
                            progress = (passed / total) * 100;
                        } else {
                            currentText = `${lessonIndex+1}. Урок`;
                        }
                        
                        // Следующее событие
                        if (i+1 < scheduleTimes.length) {
                            if (scheduleTimes[i+1].type === 'break') {
                                nextText = "Перемена";
                            } else { // Следующий урок
                                const nextLessonIndex = Math.floor((i+1) / 2);
                                if (scheduleData[day]?.[nextLessonIndex]) {
                                    nextText = scheduleData[day][nextLessonIndex].subject;
                                } else {
                                nextText = "Урок";
                                }
                            }
                        } else {
                            nextText = "";
                        }
                    } else {
                        currentText = "Перемена";
                        progress = 100;
                        
                        // Следующий урок
                        if (i+1 < scheduleTimes.length && scheduleTimes[i+1].type === 'lesson') {
                            const nextLessonIndex = Math.floor((i+1) / 2);
                            if (scheduleData[day]?.[nextLessonIndex]) {
                                nextText = scheduleData[day][nextLessonIndex].subject;
                            } else {
                                nextText = "Урок";
                            }
                        }
                    }
                    break;
                } else if (nowTime < startTime) {
                    if (i === 0) {
                        currentText = "До начала уроков";
                        progress = 0;
                    }
                    
                    if (scheduleTimes[i].type === 'lesson') {
                        const lessonIndex = Math.floor(i / 2);
                        if (scheduleData[day]?.[lessonIndex]) {
                            nextText = `${lessonIndex+1}. ${scheduleData[day][lessonIndex].subject}`;
                        } else {
                            nextText = "Урок";
                        }
                    } else {
                        nextText = "Перемена";
                    }
                    break;
                }
            }
            
            document.getElementById('currentLesson').textContent = currentText;
            document.getElementById('nextLesson').textContent = nextText;
            document.getElementById('lessonProgress').style.width = `${progress}%`;
        }
        
        // Показать текущий день
        function showCurrentDay() {
            const day = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'][new Date().getDay()];
            
            if (day === 'sunday' || day === 'saturday') {
                showNotification("Сегодня выходной!");
                return;
            }
            
            showDay(day);
        }
        
        // Показать модальное окно
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        // Скрыть модальное окно
        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Переключение режима администратора
        function toggleAdminMode() {
            if (isAdmin) {
                isAdmin = false;
                document.getElementById('adminMenuText').textContent = 'Войти как админ';
                document.getElementById('adminBtn').innerHTML = '<i class="fas fa-key text-telegram-hint"></i>';
                showNotification('Режим администратора отключен');
                showDay(currentDay);
            } else {
                showModal('adminLoginModal');
            }
        }
        
        // Вход администратора
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('adminMenuText').textContent = 'Выйти из режима админа';
                document.getElementById('adminBtn').innerHTML = '<i class="fas fa-key text-telegram-link"></i>';
                hideModal('adminLoginModal');
                document.getElementById('adminPassword').value = '';
                showNotification('Режим администратора активирован');
                showDay(currentDay);
            } else {
                showNotification('Неверный пароль', 'error');
            }
        }
        
        // Переключение сайдбара
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }
        
        // Показ уведомления
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification show';
            
            if (type === 'error') {
                notification.style.backgroundColor = '#e53935';
            } else {
                notification.style.backgroundColor = 'var(--tg-theme-button-color, #0088cc)';
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Загрузка настроек
        function loadSettings() {
            const showBreaks = localStorage.getItem('showBreaks');
            if (showBreaks !== null) {
                document.getElementById('showBreaks').checked = showBreaks === 'true';
            }
            
            const lessonDuration = localStorage.getItem('lessonDuration');
            if (lessonDuration) {
                document.getElementById('lessonDuration').value = lessonDuration;
            }
            
            const shortBreak = localStorage.getItem('shortBreak');
            if (shortBreak) {
                document.getElementById('shortBreak').value = shortBreak;
            }
            
            const longBreak = localStorage.getItem('longBreak');
            if (longBreak) {
                document.getElementById('longBreak').value = longBreak;
            }
        }
        
        // Сохранение настроек
        function saveSettings() {
            const showBreaks = document.getElementById('showBreaks').checked;
            
            // Только администратор может менять длительность уроков и перемен
            if (isAdmin) {
                const lessonDuration = document.getElementById('lessonDuration').value;
                const shortBreak = document.getElementById('shortBreak').value;
                const longBreak = document.getElementById('longBreak').value;
                
                localStorage.setItem('lessonDuration', lessonDuration);
                localStorage.setItem('shortBreak', shortBreak);
                localStorage.setItem('longBreak', longBreak);
            }
            
            localStorage.setItem('showBreaks', showBreaks);
            
            generateScheduleTimes();
            showDay(currentDay);
            hideModal('settingsModal');
            showNotification('Настройки сохранены');
        }
        
        // Показ модального окна с домашними заданиями
        function showHomeworkModal() {
            updateHomeworkList();
            showModal('homeworkModal');
        }
        
        // Обновление списка домашних заданий с улучшенным отображением
        function updateHomeworkList() {
            const container = document.getElementById('homeworkList');
            container.innerHTML = '';
            
            let hasHomework = false;
            
            for (const day in homeworkData) {
                if (homeworkData[day] && homeworkData[day].length > 0) {
                    hasHomework = true;
                    const dayNames = {
                        'monday': 'Понедельник',
                        'tuesday': 'Вторник',
                        'wednesday': 'Среда',
                        'thursday': 'Четверг',
                        'friday': 'Пятница'
                    };
                    
                    container.innerHTML += `
                        <div class="mb-4">
                            <h4 class="font-medium mb-2 flex items-center">
                                <i class="fas fa-calendar-day mr-2 text-telegram-link"></i>
                                ${dayNames[day]}
                            </h4>
                            <div class="space-y-2">
                                ${homeworkData[day].map((hw, idx) => {
                                    // Определение цвета для предмета
                                    const subjectKey = Object.keys(SUBJECT_COLORS).find(key => 
                                        hw.subject.toLowerCase().includes(key.toLowerCase())
                                    ) || "Другой";
                                    
                                    const colorClass = SUBJECT_COLORS[subjectKey] || "telegram-other";
                                    const icon = SUBJECT_ICONS[subjectKey] || "fa-book";
                                    
                                    // Проверка срока сдачи
                                    let dueDateClass = "";
                                    let dueDateText = "";
                                    
                                    if (hw.dueDate) {
                                        const dueDate = new Date(hw.dueDate);
                                        const today = new Date();
                                        today.setHours(0, 0, 0, 0);
                                        
                                        const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                                        
                                        if (diffDays < 0) {
                                            dueDateClass = "text-red-500";
                                            dueDateText = "Просрочено";
                                        } else if (diffDays === 0) {
                                            dueDateClass = "text-yellow-500";
                                            dueDateText = "Сегодня";
                                        } else if (diffDays === 1) {
                                            dueDateClass = "text-yellow-500";
                                            dueDateText = "Завтра";
                                        } else if (diffDays <= 3) {
                                            dueDateClass = "text-green-500";
                                            dueDateText = `Через ${diffDays} дня`;
                                        }
                                    }
                                    
                                    return `
                                        <div class="bg-telegram-blue/5 p-3 rounded-lg relative border-l-4 border-${colorClass}">
                                            <div class="flex items-start">
                                                <div class="subject-icon bg-${colorClass}/20 text-${colorClass} mt-1">
                                                    <i class="fas ${icon}"></i>
                                                </div>
                                                <div class="flex-1 ml-3">
                                                    <div class="font-medium">${hw.subject}</div>
                                                    <div class="text-sm text-telegram-hint mt-1">${hw.task}</div>
                                                    ${hw.dueDate ? `
                                                        <div class="flex justify-between items-center mt-2">
                                                            <div class="text-xs ${dueDateClass || 'text-telegram-hint'}">
                                                                <i class="far fa-calendar-alt mr-1"></i> 
                                                                ${formatDate(new Date(hw.dueDate))}
                                                                ${dueDateText ? ` <span class="ml-1 font-medium">${dueDateText}</span>` : ''}
                                                            </div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                            ${isAdmin ? `
                                                <button class="absolute top-2 right-2 text-telegram-hint hover:text-telegram-text" onclick="deleteHomework('${day}', ${idx})">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            ` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            
            if (!hasHomework) {
                container.innerHTML = `
                    <div class="text-center py-4 text-telegram-hint">
                        <i class="fas fa-tasks text-3xl mb-2 opacity-50"></i>
                        <p>Нет домашних заданий</p>
                    </div>
                `;
            }
        }
        
        // Добавление домашнего задания
        function addHomework() {
            const subject = document.getElementById('hwSubject').value.trim();
            const task = document.getElementById('hwTask').value.trim();
            const dueDate = document.getElementById('hwDueDate').value;
            
            if (!subject || !task || !dueDate) {
                showNotification('Заполните все поля включая дату', 'error');
                return;
            }
            
            // Определяем день недели по дате сдачи
            const dueDateObj = new Date(dueDate);
            const dayOfWeek = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'][dueDateObj.getDay()];
            
            // Проверка на выходной
            if (dayOfWeek === 'saturday' || dayOfWeek === 'sunday') {
                showNotification('Выбрана дата выходного дня, выберите учебный день', 'error');
                return;
            }
            
            // Сохраняем задание в день, соответствующий дате сдачи
            if (!homeworkData[dayOfWeek]) {
                homeworkData[dayOfWeek] = [];
            }
            
            homeworkData[dayOfWeek].push({
                subject,
                task,
                dueDate,
                createdAt: new Date().toISOString()
            });
            
            // Сохранение в localStorage
            localStorage.setItem(`homeworkData_${currentClass}`, JSON.stringify(homeworkData));
            
            // Очистка полей и обновление списка
            document.getElementById('hwSubject').value = '';
            document.getElementById('hwTask').value = '';
            document.getElementById('hwDueDate').value = '';
            
            updateHomeworkList();
            showDay(currentDay); // Обновляем отображение текущего дня
            showNotification('Домашнее задание добавлено');
        }
        
        // Удаление домашнего задания
        function deleteHomework(day, index) {
            if (homeworkData[day] && homeworkData[day][index]) {
                homeworkData[day].splice(index, 1);
                
                if (homeworkData[day].length === 0) {
                    delete homeworkData[day];
                }
                
                // Сохранение в localStorage
                localStorage.setItem(`homeworkData_${currentClass}`, JSON.stringify(homeworkData));
                
                updateHomeworkList();
                showDay(currentDay); // Обновляем отображение текущего дня
                showNotification('Домашнее задание удалено');
            }
        }
        
        // Показ модального окна с заметками
        function showNotesModal() {
            updateNotesList();
            showModal('notesModal');
        }
        
        // Обновление списка заметок
        function updateNotesList() {
            const container = document.getElementById('notesList');
            container.innerHTML = '';
            
            let hasNotes = false;
            
            for (const day in notesData) {
                if (notesData[day] && notesData[day].length > 0) {
                    hasNotes = true;
                    const dayNames = {
                        'monday': 'Понедельник',
                        'tuesday': 'Вторник',
                        'wednesday': 'Среда',
                        'thursday': 'Четверг',
                        'friday': 'Пятница'
                    };
                    
                    container.innerHTML += `
                        <div class="mb-3">
                            <h4 class="font-medium mb-2">${dayNames[day]}</h4>
                            ${notesData[day].map((note, idx) => `
                                <div class="bg-telegram-blue/5 p-3 rounded-lg mb-2 relative">
                                    ${note.title ? `<div class="font-medium">${note.title}</div>` : ''}
                                    <div class="text-sm text-telegram-hint mt-1">${note.content}</div>
                                    ${isAdmin ? `
                                        <button class="absolute top-2 right-2 text-telegram-hint hover:text-telegram-text" onclick="deleteNote('${day}', ${idx})">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            }
            
            if (!hasNotes) {
                container.innerHTML = `
                    <div class="text-center py-4 text-telegram-hint">
                        <i class="fas fa-sticky-note text-3xl mb-2 opacity-50"></i>
                        <p>Нет заметок</p>
                    </div>
                `;
            }
        }
        
        // Добавление заметки
        function addNote() {
            const title = document.getElementById('noteTitle').value.trim();
            const content = document.getElementById('noteContent').value.trim();
            
            if (!content) {
                showNotification('Заполните поле содержания', 'error');
                return;
            }
            
            // Определение дня для заметки
            const day = currentDay;
            
            if (!notesData[day]) {
                notesData[day] = [];
            }
            
            notesData[day].push({
                title,
                content,
                createdAt: new Date().toISOString()
            });
            
            // Сохранение в localStorage
            localStorage.setItem(`notesData_${currentClass}`, JSON.stringify(notesData));
            
            // Очистка полей и обновление списка
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            
            updateNotesList();
            showDay(currentDay); // Обновляем отображение текущего дня
            showNotification('Заметка добавлена');
        }
        
        // Удаление заметки
        function deleteNote(day, index) {
            if (notesData[day] && notesData[day][index]) {
                notesData[day].splice(index, 1);
                
                if (notesData[day].length === 0) {
                    delete notesData[day];
                }
                
                // Сохранение в localStorage
                localStorage.setItem(`notesData_${currentClass}`, JSON.stringify(notesData));
                
                updateNotesList();
                showDay(currentDay); // Обновляем отображение текущего дня
                showNotification('Заметка удалена');
            }
        }
        
        // Показ модального окна добавления урока
        function showAddLessonModal() {
            // Очистка полей
            document.getElementById('addSubject').value = '';
            document.getElementById('addRoom').value = '';
            document.getElementById('addTeacher').value = '';
            
            showModal('addLessonModal');
        }
        
        // Добавление урока
        function addLesson() {
            const subject = document.getElementById('addSubject').value.trim();
            const room = document.getElementById('addRoom').value.trim();
            const teacher = document.getElementById('addTeacher').value.trim();
            
            if (!subject) {
                showNotification('Введите название предмета', 'error');
                return;
            }
            
            if (!scheduleData[currentDay]) {
                scheduleData[currentDay] = [];
            }
            
            scheduleData[currentDay].push({
                subject,
                room: room || 'Не указан',
                teacher: teacher || 'Не указан'
            });
            
            // Сохранение в localStorage
            localStorage.setItem(`scheduleData_${currentClass}`, JSON.stringify(scheduleData));
            
            hideModal('addLessonModal');
            showDay(currentDay);
            showNotification('Урок добавлен');
        }
        
        // Показ модального окна редактирования урока
        function showEditLessonModal(day, index) {
            const lesson = scheduleData[day][index];
            
            document.getElementById('editLessonDay').value = day;
            document.getElementById('editLessonIndex').value = index;
            document.getElementById('editSubject').value = lesson.subject;
            document.getElementById('editRoom').value = lesson.room;
            document.getElementById('editTeacher').value = lesson.teacher;
            
            showModal('editLessonModal');
        }
        
        // Сохранение изменений урока
        function saveLesson() {
            const day = document.getElementById('editLessonDay').value;
            const index = parseInt(document.getElementById('editLessonIndex').value);
            const subject = document.getElementById('editSubject').value.trim();
            const room = document.getElementById('editRoom').value.trim();
            const teacher = document.getElementById('editTeacher').value.trim();
            
            if (!subject) {
                showNotification('Введите название предмета', 'error');
                return;
            }
            
            scheduleData[day][index] = {
                subject,
                room: room || 'Не указан',
                teacher: teacher || 'Не указан'
            };
            
            // Сохранение в localStorage
            localStorage.setItem(`scheduleData_${currentClass}`, JSON.stringify(scheduleData));
            
            hideModal('editLessonModal');
            showDay(currentDay);
            showNotification('Урок обновлен');
        }
        
        // Удаление урока
        function deleteLesson() {
            const day = document.getElementById('editLessonDay').value;
            const index = parseInt(document.getElementById('editLessonIndex').value);
            
            scheduleData[day].splice(index, 1);
            
            // Сохранение в localStorage
            localStorage.setItem(`scheduleData_${currentClass}`, JSON.stringify(scheduleData));
            
            hideModal('editLessonModal');
            showDay(currentDay);
            showNotification('Урок удален');
        }
        
        // Показ настроек
        function showSettingsModal() {
            // Обновляем состояние полей в зависимости от прав администратора
            const lessonDurationInput = document.getElementById('lessonDuration');
            const shortBreakInput = document.getElementById('shortBreak');
            const longBreakInput = document.getElementById('longBreak');
            const settingsMessage = document.getElementById('settingsAdminMessage');
            
            if (!isAdmin) {
                lessonDurationInput.disabled = true;
                shortBreakInput.disabled = true;
                longBreakInput.disabled = true;
                settingsMessage.classList.remove('hidden');
            } else {
                lessonDurationInput.disabled = false;
                shortBreakInput.disabled = false;
                longBreakInput.disabled = false;
                settingsMessage.classList.add('hidden');
            }
            
            showModal('settingsModal');
        }
        
        // Показ модального окна "О приложении"
        function showAboutModal() {
            showModal('aboutModal');
        }
        
        // Показ модального окна помощи
        function showHelpModal() {
            showModal('helpModal');
        }
        
        // Показ статистики
        function showStatistics() {
            // Расчет статистики
            let totalLessons = 0;
            let totalHomework = 0;
            let totalNotes = 0;
            let subjectCounts = {};
            
            // Подсчет уроков и предметов
            for (const day in scheduleData) {
                if (Array.isArray(scheduleData[day])) {
                    totalLessons += scheduleData[day].length;
                    
                    scheduleData[day].forEach(lesson => {
                        const subject = lesson.subject;
                        subjectCounts[subject] = (subjectCounts[subject] || 0) + 1;
                    });
                }
            }
            
            // Подсчет домашних заданий
            for (const day in homeworkData) {
                if (Array.isArray(homeworkData[day])) {
                    totalHomework += homeworkData[day].length;
                }
            }
            
            // Подсчет заметок
            for (const day in notesData) {
                if (Array.isArray(notesData[day])) {
                    totalNotes += notesData[day].length;
                }
            }
            
            // Расчет дней до каникул (условно)
            const now = new Date();
            const summerHolidays = new Date(now.getFullYear(), 5, 1); // 1 июня
            if (now > summerHolidays) {
                summerHolidays.setFullYear(now.getFullYear() + 1);
            }
            const daysToHolidays = Math.ceil((summerHolidays - now) / (1000 * 60 * 60 * 24));
            
            // Обновление значений
            document.getElementById('totalLessons').textContent = totalLessons;
            document.getElementById('totalHomework').textContent = totalHomework;
            document.getElementById('totalNotes').textContent = totalNotes;
            document.getElementById('daysToHolidays').textContent = daysToHolidays;
            
            // Формирование графика распределения предметов
            const subjectDistribution = document.getElementById('subjectDistribution');
            subjectDistribution.innerHTML = '';
            
            const sortedSubjects = Object.entries(subjectCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5); // Топ-5 предметов
            
            sortedSubjects.forEach(([subject, count]) => {
                const percent = Math.round((count / totalLessons) * 100);
                
                const subjectKey = Object.keys(SUBJECT_COLORS).find(key => 
                    subject.toLowerCase().includes(key.toLowerCase())
                ) || "Другой";
                
                const colorClass = SUBJECT_COLORS[subjectKey] || "telegram-other";
                
                subjectDistribution.innerHTML += `
                    <div>
                        <div class="flex justify-between text-sm">
                            <span>${subject}</span>
                            <span>${count} (${percent}%)</span>
                        </div>
                        <div class="w-full bg-telegram-blue/10 rounded-full h-2 mt-1">
                            <div class="bg-${colorClass} h-2 rounded-full" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            });
            
            showModal('statisticsModal');
        }
        
        // Показ календаря
        function showCalendar() {
            // Загрузка событий календаря из localStorage
            const savedEvents = localStorage.getItem('calendarEvents');
            if (savedEvents) {
                calendarEvents = JSON.parse(savedEvents);
            } else {
                calendarEvents = [...HOLIDAYS]; // Инициализация праздниками
                localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
            }
            
            currentCalendarMonth = new Date();
            selectedCalendarDay = new Date();
            
            renderCalendar();
            showModal('calendarModal');
        }
        
        // Показ информации о преподавателях
        function showTeachers() {
            // Загрузка данных преподавателей
            loadTeachersList();
            showModal('teachersModal');
        }
        
        // Автодополнение предмета
        function autocompleteSubject(input) {
            const val = input.value.toLowerCase();
            const container = input.id === 'addSubject' ? 'subjectAutocomplete' : 'editSubjectAutocomplete';
            const autocompleteItems = document.getElementById(container);
            
            // Очистка предыдущих вариантов
            autocompleteItems.innerHTML = '';
            
            if (!val) {
                return false;
            }
            
            let hasMatches = false;
            
            // Поиск совпадений
            SUBJECTS.forEach(subject => {
                if (subject.toLowerCase().indexOf(val) > -1) {
                    hasMatches = true;
                    const div = document.createElement('div');
                    div.innerHTML = subject;
                    div.onclick = function() {
                        input.value = subject;
                        autocompleteItems.innerHTML = '';
                    };
                    autocompleteItems.appendChild(div);
                }
            });
            
            if (!hasMatches) {
                autocompleteItems.innerHTML = '<div>Нет совпадений</div>';
            }
        }
        
        // Форматирование времени
        function formatTime(date) {
            return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        }
        
        // Форматирование даты
        function formatDate(date) {
            return date.toLocaleDateString('ru-RU', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric' 
            });
        }
        
        // Переключение видимости пароля
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('adminPassword');
            const toggleIcon = document.getElementById('passwordToggleIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
        
        // Служебные функции для календаря
        function formatDateISO(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }
        
        // Изменение месяца в календаре
        function changeMonth(delta) {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + delta);
            renderCalendar();
        }
        
        // Рендеринг календаря
        function renderCalendar() {
            const year = currentCalendarMonth.getFullYear();
            const month = currentCalendarMonth.getMonth();
            
            // Установка заголовка месяца
            const monthNames = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 
                               'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Получение первого дня месяца
            const firstDay = new Date(year, month, 1);
            // День недели первого дня (0 - воскресенье, 1 - понедельник, ...)
            let dayOfWeek = firstDay.getDay();
            dayOfWeek = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Перевод на европейский формат (0 - понедельник)
            
            // Получение количества дней в месяце
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Генерация сетки календаря
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Добавление пустых ячеек до начала месяца
            for (let i = 0; i < dayOfWeek; i++) {
                calendarDays.innerHTML += `<div class="calendar-day h-10 opacity-30 bg-telegram-blue/5 rounded-lg"></div>`;
            }
            
            // Добавление дней месяца
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDateISO(date);
                
                // Проверяем события для этого дня
                const dayEvents = calendarEvents.filter(event => event.date === dateStr);
                
                // Определяем классы для дня
                let dayClasses = 'calendar-day h-10 flex flex-col items-center justify-center bg-telegram-blue/5 rounded-lg relative hover:bg-telegram-blue/10 cursor-pointer';
                
                // Выходные
                const dayNum = date.getDay();
                if (dayNum === 0 || dayNum === 6) {
                    dayClasses += ' text-telegram-link/70';
                }
                
                // Сегодняшний день
                const today = new Date();
                if (date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear()) {
                    dayClasses += ' bg-telegram-blue/20 font-medium';
                }
                
                // Выбранный день
                if (date.getDate() === selectedCalendarDay.getDate() && date.getMonth() === selectedCalendarDay.getMonth() && date.getFullYear() === selectedCalendarDay.getFullYear()) {
                    dayClasses += ' border-2 border-telegram-button';
                }
                
                // Маркеры для событий дня
                let eventMarkers = '';
                if (dayEvents.length > 0) {
                    const hasHoliday = dayEvents.some(e => e.type === 'holiday');
                    const hasExam = dayEvents.some(e => e.type === 'exam');
                    const hasActivity = dayEvents.some(e => e.type === 'activity');
                    
                    if (hasHoliday) {
                        dayClasses += ' bg-red-400/20 text-red-400';
                    }
                    
                    if (dayEvents.length > 0) {
                        eventMarkers = `
                            <div class="absolute bottom-1 flex justify-center space-x-1">
                                ${hasHoliday ? `<div class="w-1.5 h-1.5 rounded-full bg-red-400"></div>` : ''}
                                ${hasExam ? `<div class="w-1.5 h-1.5 rounded-full bg-yellow-400"></div>` : ''}
                                ${hasActivity ? `<div class="w-1.5 h-1.5 rounded-full bg-green-400"></div>` : ''}
                                ${!hasHoliday && !hasExam && !hasActivity ? `<div class="w-1.5 h-1.5 rounded-full bg-blue-400"></div>` : ''}
                            </div>
                        `;
                    }
                }
                
                calendarDays.innerHTML += `
                    <div class="${dayClasses}" onclick="selectCalendarDay(${day}, ${month}, ${year})">
                        ${day}
                        ${eventMarkers}
                    </div>
                `;
            }
            
            // Показать события для выбранного дня
            showCalendarDayEvents();
        }
        
        // Выбор дня в календаре
        function selectCalendarDay(day, month, year) {
            selectedCalendarDay = new Date(year, month, day);
            renderCalendar();
        }
        
        // Показать события для выбранного дня
        function showCalendarDayEvents() {
            const dateStr = formatDateISO(selectedCalendarDay);
            const dayEvents = calendarEvents.filter(event => event.date === dateStr);
            
            const eventsContainer = document.getElementById('calendarEvents');
            
            if (dayEvents.length === 0) {
                eventsContainer.innerHTML = `
                    <div class="text-center py-2 text-telegram-hint">
                        <p>Нет событий на этот день</p>
                    </div>
                `;
                return;
            }
            
            eventsContainer.innerHTML = '';
            
            // Группировка событий по типу
            const eventTypes = {
                holiday: { icon: 'fa-umbrella-beach', color: 'red-400', label: 'Праздник' },
                exam: { icon: 'fa-graduation-cap', color: 'yellow-400', label: 'Контрольная работа' },
                activity: { icon: 'fa-bullhorn', color: 'green-400', label: 'Мероприятие' },
                lesson: { icon: 'fa-book', color: 'blue-400', label: 'Урок' }
            };
            
            dayEvents.forEach(event => {
                const type = eventTypes[event.type] || eventTypes.lesson;
                
                eventsContainer.innerHTML += `
                    <div class="bg-telegram-blue/5 p-3 rounded-lg relative">
                        <div class="flex items-start">
                            <div class="w-8 h-8 rounded-full bg-${type.color}/20 flex items-center justify-center text-${type.color} mr-3 flex-shrink-0">
                                <i class="fas ${type.icon}"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <div class="font-medium">${event.title}</div>
                                    <div class="text-xs bg-${type.color}/20 text-${type.color} px-2 py-1 rounded-full">${type.label}</div>
                                </div>
                                ${event.description ? `<div class="text-sm text-telegram-hint mt-1">${event.description}</div>` : ''}
                            </div>
                        </div>
                        ${isAdmin ? `
                            <button class="absolute bottom-2 right-2 text-telegram-hint hover:text-telegram-text" onclick="deleteCalendarEvent('${dateStr}', '${event.title}')">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        ` : ''}
                    </div>
                `;
            });
        }
        
        // Показать модальное окно добавления события
        function showAddEventModal() {
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('eventDate').value = formatDateISO(selectedCalendarDay);
            document.getElementById('eventType').value = 'lesson';
            
            hideModal('calendarModal');
            showModal('addEventModal');
        }
        
        // Добавление события календаря
        function addCalendarEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const description = document.getElementById('eventDescription').value.trim();
            const date = document.getElementById('eventDate').value;
            const type = document.getElementById('eventType').value;
            
            if (!title || !date) {
                showNotification('Введите название и дату события', 'error');
                return;
            }
            
            const newEvent = {
                title,
                description,
                date,
                type,
                createdAt: new Date().toISOString()
            };
            
            calendarEvents.push(newEvent);
            
            // Сохранение в localStorage
            localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
            
            hideModal('addEventModal');
            showModal('calendarModal');
            
            // Обновление выбранной даты и перерисовка календаря
            const eventDate = new Date(date);
            currentCalendarMonth = new Date(eventDate.getFullYear(), eventDate.getMonth(), 1);
            selectedCalendarDay = new Date(eventDate);
            
            renderCalendar();
            showNotification('Событие добавлено');
        }
        
        // Удаление события календаря
        function deleteCalendarEvent(dateStr, title) {
            const eventIndex = calendarEvents.findIndex(event => 
                event.date === dateStr && event.title === title
            );
            
            if (eventIndex !== -1) {
                calendarEvents.splice(eventIndex, 1);
                
                // Сохранение в localStorage
                localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
                
                renderCalendar();
                showNotification('Событие удалено');
            }
        }

        // Список преподавателей
        const TEACHERS = [
            { 
                id: 1, 
                name: "Иванова Анна Петровна", 
                subject: "Математика", 
                photo: "https://randomuser.me/api/portraits/women/44.jpg",
                email: "ivanova@school.edu",
                phone: "+7 (900) 123-45-67",
                experience: "15 лет",
                education: "МГУ, математический факультет",
                schedule: {
                    monday: ["10А", "11Б"],
                    tuesday: ["10А", "10Б"],
                    wednesday: ["11А"],
                    thursday: ["10Б", "11Б"],
                    friday: ["10А", "11А"]
                },
                bio: "Опытный педагог с индивидуальным подходом к каждому ученику. Эксперт ЕГЭ и ОГЭ по математике с 2010 года."
            },
            { 
                id: 2, 
                name: "Сидоров Михаил Викторович", 
                subject: "Физика", 
                photo: "https://randomuser.me/api/portraits/men/42.jpg",
                email: "sidorov@school.edu",
                phone: "+7 (900) 123-45-68",
                experience: "10 лет",
                education: "МФТИ, физико-технический факультет",
                schedule: {
                    monday: ["10А", "11Б"],
                    tuesday: ["11А"],
                    wednesday: [],
                    thursday: ["10Б"],
                    friday: ["10А", "11Б"]
                },
                bio: "Увлеченный физикой преподаватель, автор методических пособий. Руководитель школьного физического клуба."
            },
            { 
                id: 3, 
                name: "Петрова Светлана Игоревна", 
                subject: "Русский язык и литература", 
                photo: "https://randomuser.me/api/portraits/women/67.jpg",
                email: "petrova@school.edu",
                phone: "+7 (900) 123-45-69",
                experience: "20 лет",
                education: "МПГУ, филологический факультет",
                schedule: {
                    monday: ["11А", "11Б"],
                    tuesday: ["10А", "10Б"],
                    wednesday: ["10А", "11А"],
                    thursday: [],
                    friday: ["10Б", "11Б"]
                },
                bio: "Заслуженный учитель РФ, руководитель школьного литературного кружка. Автор сборников поэзии."
            },
            { 
                id: 4, 
                name: "Смирнова Елена Владимировна", 
                subject: "Английский язык", 
                photo: "https://randomuser.me/api/portraits/women/33.jpg",
                email: "smirnova@school.edu",
                phone: "+7 (900) 123-45-70",
                experience: "8 лет",
                education: "ВШЭ, лингвистика",
                schedule: {
                    monday: [],
                    tuesday: ["10А", "11Б"],
                    wednesday: ["10Б", "11А"],
                    thursday: ["10А", "11Б"],
                    friday: []
                },
                bio: "Преподаватель с международными сертификатами IELTS и TOEFL, организатор школьных языковых клубов."
            },
            { 
                id: 5, 
                name: "Козлов Андрей Валерьевич", 
                subject: "Физкультура", 
                photo: "https://randomuser.me/api/portraits/men/86.jpg",
                email: "kozlov@school.edu",
                phone: "+7 (900) 123-45-71",
                experience: "12 лет",
                education: "РГУФКСиТ",
                schedule: {
                    monday: ["10Б", "11А"],
                    tuesday: [],
                    wednesday: ["10А", "11Б"],
                    thursday: ["10Б", "11А"],
                    friday: ["10А", "11Б"]
                },
                bio: "Мастер спорта по легкой атлетике, тренер школьной команды по баскетболу. Судья республиканской категории."
            }
        ];

        // Загрузка списка преподавателей
        function loadTeachersList() {
            const container = document.getElementById('teachersList');
            container.innerHTML = '';
            
            TEACHERS.forEach(teacher => {
                // Определение предмета для цвета
                const subjectKey = Object.keys(SUBJECT_COLORS).find(key => 
                    teacher.subject.toLowerCase().includes(key.toLowerCase())
                ) || "Другой";
                
                const colorClass = SUBJECT_COLORS[subjectKey] || "telegram-other";
                
                container.innerHTML += `
                    <div class="teacher-card bg-telegram-blue/5 p-3 rounded-lg mb-3 flex items-center hover:bg-telegram-blue/10 cursor-pointer transition" 
                         onclick="showTeacherDetails(${teacher.id})">
                        <div class="teacher-image mr-3">
                            <img src="${teacher.photo}" alt="${teacher.name}" class="w-12 h-12 rounded-full object-cover border-2 border-${colorClass}">
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">${teacher.name}</div>
                            <div class="text-sm text-telegram-hint">${teacher.subject}</div>
                        </div>
                        <div class="text-telegram-hint">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                `;
            });
        }

        // Фильтрация преподавателей при поиске
        function filterTeachers() {
            const searchQuery = document.getElementById('teacherSearch').value.toLowerCase();
            const teacherCards = document.querySelectorAll('.teacher-card');
            
            teacherCards.forEach(card => {
                const name = card.querySelector('.font-medium').textContent.toLowerCase();
                const subject = card.querySelector('.text-telegram-hint').textContent.toLowerCase();
                
                if (name.includes(searchQuery) || subject.includes(searchQuery)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Показ детальной информации о преподавателе
        function showTeacherDetails(teacherId) {
            const teacher = TEACHERS.find(t => t.id === teacherId);
            if (!teacher) return;
            
            document.getElementById('teacherDetailsName').innerHTML = `
                <i class="fas fa-user mr-2 text-telegram-link"></i> ${teacher.name}
            `;
            
            // Определение предмета для цвета
            const subjectKey = Object.keys(SUBJECT_COLORS).find(key => 
                teacher.subject.toLowerCase().includes(key.toLowerCase())
            ) || "Другой";
            
            const colorClass = SUBJECT_COLORS[subjectKey] || "telegram-other";
            const icon = SUBJECT_ICONS[subjectKey] || "fa-book";
            
            // Форматирование расписания преподавателя
            let scheduleHTML = '';
            const days = {
                monday: 'Понедельник',
                tuesday: 'Вторник',
                wednesday: 'Среда',
                thursday: 'Четверг',
                friday: 'Пятница'
            };
            
            for (const day in days) {
                const classes = teacher.schedule[day] || [];
                
                scheduleHTML += `
                    <div class="flex justify-between mb-1">
                        <div class="text-telegram-hint">${days[day]}:</div>
                        <div>${classes.length > 0 ? classes.join(', ') : '<span class="text-telegram-hint">—</span>'}</div>
                    </div>
                `;
            }
            
            document.getElementById('teacherDetailsContent').innerHTML = `
                <div class="flex flex-col sm:flex-row items-center sm:items-start mb-4">
                    <img src="${teacher.photo}" alt="${teacher.name}" class="w-24 h-24 rounded-full object-cover border-2 border-${colorClass} mb-3 sm:mb-0 sm:mr-4">
                    <div class="flex-1 text-center sm:text-left">
                        <div class="inline-flex items-center bg-${colorClass}/20 text-${colorClass} px-3 py-1 rounded-full text-sm mb-2">
                            <i class="fas ${icon} mr-2"></i>
                            ${teacher.subject}
                        </div>
                        <p class="text-sm text-telegram-hint mb-2">${teacher.bio}</p>
                        <div class="text-sm">
                            <div><i class="fas fa-envelope mr-2 text-telegram-hint"></i> ${teacher.email}</div>
                            <div class="mt-1"><i class="fas fa-phone mr-2 text-telegram-hint"></i> ${teacher.phone}</div>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div class="bg-telegram-blue/5 p-3 rounded-lg">
                        <h4 class="font-medium mb-2">Образование</h4>
                        <p class="text-sm text-telegram-hint">${teacher.education}</p>
                    </div>
                    <div class="bg-telegram-blue/5 p-3 rounded-lg">
                        <h4 class="font-medium mb-2">Стаж работы</h4>
                        <p class="text-sm text-telegram-hint">${teacher.experience}</p>
                    </div>
                </div>
                
                <div class="bg-telegram-blue/5 p-3 rounded-lg">
                    <h4 class="font-medium mb-2">Расписание занятий</h4>
                    <div class="text-sm">
                        ${scheduleHTML}
                    </div>
                </div>
            `;
            
            hideModal('teachersModal');
            showModal('teacherDetailsModal');
        }

        // Глобальные переменные для работы с Telegram
        let telegramUser = null;

        // Инициализация Telegram логина
        function initTelegramLogin() {
            const telegramLoginDiv = document.getElementById('telegramLogin');
            
            // Создаем скрипт для загрузки Telegram виджета
            const script = document.createElement('script');
            script.src = 'https://telegram.org/js/telegram-widget.js?22';
            script.setAttribute('data-telegram-login', 'School_Schedule_11B_BOT'); // Замените на имя вашего бота
            script.setAttribute('data-size', 'medium');
            script.setAttribute('data-radius', '8');
            script.setAttribute('data-request-access', 'write');
            script.setAttribute('data-userpic', 'true');
            script.setAttribute('data-onauth', 'onTelegramAuth(user)');
            
            telegramLoginDiv.appendChild(script);
        }

        // Callback функция после успешной авторизации
        function onTelegramAuth(user) {
            telegramUser = user;
            
            // Сохраняем данные пользователя
            localStorage.setItem('telegramUser', JSON.stringify(user));
            
            // Обновляем UI
            updateUserInterface();
            
            // Показываем уведомление
            showNotification('Вы успешно вошли в систему');
        }

        // Обновление интерфейса после входа/выхода
        function updateUserInterface() {
            const loginDiv = document.getElementById('telegramLogin');
            const profileDiv = document.getElementById('userProfile');
            const userAvatar = document.getElementById('userAvatar');
            
            if (telegramUser) {
                // Скрываем кнопку входа и показываем профиль
                loginDiv.style.display = 'none';
                profileDiv.style.display = 'flex';
                
                // Обновляем аватар
                userAvatar.src = telegramUser.photo_url || 'path/to/default/avatar.png';
                
                // Обновляем данные в модальном окне профиля
                document.getElementById('profileAvatar').src = telegramUser.photo_url || 'path/to/default/avatar.png';
                document.getElementById('profileName').textContent = `${telegramUser.first_name} ${telegramUser.last_name || ''}`;
                document.getElementById('profileUsername').textContent = `@${telegramUser.username}`;
                
                // Обновляем статистику
                updateProfileStatistics();
            } else {
                // Показываем кнопку входа и скрываем профиль
                loginDiv.style.display = 'block';
                profileDiv.style.display = 'none';
            }
        }

        // Обновление статистики профиля
        function updateProfileStatistics() {
            let homeworkCount = 0;
            let notesCount = 0;
            
            // Подсчет домашних заданий
            Object.values(homeworkData).forEach(dayHomework => {
                homeworkCount += dayHomework.length;
            });
            
            // Подсчет заметок
            Object.values(notesData).forEach(dayNotes => {
                notesCount += dayNotes.length;
            });
            
            document.getElementById('profileHomeworkCount').textContent = homeworkCount;
            document.getElementById('profileNotesCount').textContent = notesCount;
        }

        // Показ модального окна профиля
        function showProfileModal() {
            if (telegramUser) {
                updateProfileStatistics();
                showModal('profileModal');
            }
        }

        // Выход из аккаунта
        function logoutTelegram() {
            telegramUser = null;
            localStorage.removeItem('telegramUser');
            updateUserInterface();
            hideModal('profileModal');
            showNotification('Вы вышли из системы');
        }

        // Проверка сохраненной сессии при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Существующий код инициализации...
            
            // Инициализация Telegram логина
            initTelegramLogin();
            
            // Проверяем сохраненную сессию
            const savedUser = localStorage.getItem('telegramUser');
            if (savedUser) {
                telegramUser = JSON.parse(savedUser);
                updateUserInterface();
            }
        });

        // Модифицируем функции работы с данными, чтобы привязать их к пользователю
        function saveUserData(key, data) {
            if (telegramUser) {
                const userId = telegramUser.id;
                localStorage.setItem(`${key}_${userId}`, JSON.stringify(data));
            }
        }

        function loadUserData(key) {
            if (telegramUser) {
                const userId = telegramUser.id;
                const data = localStorage.getItem(`${key}_${userId}`);
                return data ? JSON.parse(data) : null;
            }
            return null;
        }

        // Обновляем существующие функции для работы с данными пользователя
        function addHomework() {
            // Существующий код...
            
            // Сохраняем с привязкой к пользователю
            saveUserData(`homeworkData_${currentClass}`, homeworkData);
        }

        function addNote() {
            // Существующий код...
            
            // Сохраняем с привязкой к пользователю
            saveUserData(`notesData_${currentClass}`, notesData);
        }
    </script>
    
</body>
</html>

